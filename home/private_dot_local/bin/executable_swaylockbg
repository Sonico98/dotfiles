#!/bin/bash

# Bailout early if hyprlock is already running
if pidof hyprlock; then
	exit 0
fi

# Pause music and notifications, mute audio and microphone.
playerctl --player=%any,firefox pause || true
wpctl set-mute @DEFAULT_AUDIO_SINK@ 1 || true
wpctl set-mute @DEFAULT_AUDIO_SOURCE@ 1 || true
dunstctl set-paused true || true

# Turn the screen off after five seconds, 
# turn it back on when activity is detected 
# and automatically set the screen brightness
swayidle timeout 5 'swaymsg "output * power off"' resume \
	'swaymsg "output * power on"' &

IDLEPID=$!
touch $LOCKSCREEN_DIR/idlepid
echo "$IDLEPID" >| "$LOCKSCREEN_DIR"/idlepid

hyprlock
